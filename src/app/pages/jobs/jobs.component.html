<div class="max-w-[1600px] mx-auto px-6 py-8">

    <!-- Header -->
    <div class="mb-8 flex items-center justify-between">
        <div>
            <h1 class="text-[24px] font-normal text-on-surface">Positions</h1>
            <p class="text-[14px] text-on-surface-variant mt-1">Manage your open roles and hiring pipeline</p>
        </div>
        <button class="flex items-center gap-2 px-6 h-10 bg-primary text-on-primary rounded-full text-sm font-medium hover:shadow-md transition-all">
            <span class="material-icons text-[18px]">add</span>
            New Position
        </button>
    </div>

    <!-- Filters Bar (M3 Chips/Inputs) -->
    <div class="mb-6 flex flex-col md:flex-row gap-4">
        <!-- Search -->
        <div class="relative flex-1 max-w-md">
            <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-on-surface-variant text-[20px]">search</span>
            <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="applyFilters()"
                placeholder="Search positions..."
                class="w-full h-10 pl-10 pr-4 bg-surface-container-high border-none rounded-full text-sm text-on-surface placeholder:text-on-surface-variant focus:ring-2 focus:ring-primary focus:outline-none transition-all" />
        </div>

        <!-- Filter Chips (Visual only for select inputs) -->
        <div class="flex gap-2 overflow-x-auto pb-2">
            <select [(ngModel)]="statusFilter" (ngModelChange)="loadJobs()"
                class="h-8 px-4 bg-surface border border-outline rounded-[8px] text-xs font-medium text-on-surface hover:bg-surface-container-high focus:outline-none cursor-pointer">
                <option value="all">All Status</option>
                <option value="open">Open</option>
                <option value="closed">Closed</option>
                <option value="filled">Filled</option>
            </select>

            <select [(ngModel)]="departmentFilter" (ngModelChange)="applyFilters()"
                class="h-8 px-4 bg-surface border border-outline rounded-[8px] text-xs font-medium text-on-surface hover:bg-surface-container-high focus:outline-none cursor-pointer">
                <option value="all">All Departments</option>
                <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
            </select>

            <select [(ngModel)]="sortBy" (ngModelChange)="applyFilters()"
                class="h-8 px-4 bg-surface border border-outline rounded-[8px] text-xs font-medium text-on-surface hover:bg-surface-container-high focus:outline-none cursor-pointer">
                <option value="updated">Last Updated</option>
                <option value="title">Title</option>
                <option value="applications">Applications</option>
                <option value="deadline">Deadline</option>
            </select>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center py-20">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
    </div>

    <!-- Data Table (M3) -->
    <div *ngIf="!loading" class="bg-surface rounded-[16px] border border-outline-variant overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-surface-container-low border-b border-outline-variant">
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider">Position</th>
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider">Department</th>
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider">Location</th>
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider">Candidates</th>
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider">Last Updated</th>
                        <th class="px-6 py-3 text-[11px] font-bold text-on-surface-variant uppercase tracking-wider text-right">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-outline-variant">
                    <tr *ngFor="let job of filteredJobs" class="hover:bg-surface-container-high transition-colors group">
                        <!-- Position -->
                        <td class="px-6 py-3">
                            <div class="flex items-center gap-3">
                                <button (click)="toggleStar(job, $event)" class="text-on-surface-variant hover:text-primary transition-colors focus:outline-none">
                                    <span class="material-icons text-[20px]" [class.text-primary]="job.starred">{{ job.starred ? 'star' : 'star_border' }}</span>
                                </button>
                                <div>
                                    <a [routerLink]="['/jobs', job.id]" class="text-[14px] font-medium text-on-surface hover:text-primary hover:underline block">
                                        {{ job.title }}
                                    </a>
                                    <span class="text-[12px] text-on-surface-variant">{{ job.employment_type | titlecase }}</span>
                                </div>
                            </div>
                        </td>

                        <!-- Department -->
                        <td class="px-6 py-3 text-[14px] text-on-surface">{{ job.department }}</td>

                        <!-- Location -->
                        <td class="px-6 py-3 text-[14px] text-on-surface">{{ job.location }}</td>

                        <!-- Candidates -->
                        <td class="px-6 py-3">
                            <div class="flex items-center gap-2">
                                <span class="text-[14px] font-medium text-on-surface">{{ job.applications_count }}</span>
                                <div class="flex h-1.5 w-12 bg-surface-container-highest rounded-full overflow-hidden">
                                    <div class="bg-primary h-full" [style.width]="(job.applications_count / 20 * 100) + '%'"></div>
                                </div>
                            </div>
                        </td>

                        <!-- Status -->
                        <td class="px-6 py-3">
                            <span class="inline-flex items-center px-2 py-1 rounded-[8px] text-[11px] font-medium border border-transparent"
                                  [ngClass]="getStatusBadgeClass(job.status)">
                                {{ job.status | titlecase }}
                            </span>
                        </td>

                        <!-- Last Updated -->
                        <td class="px-6 py-3 text-[12px] text-on-surface-variant">
                            {{ getTimeAgo(job.updated_at) }}
                        </td>

                        <!-- Actions -->
                        <td class="px-6 py-3 text-right relative">
                            <button class="text-on-surface-variant hover:bg-surface-container-highest rounded-full p-1 transition-colors focus:outline-none group/menu">
                                <span class="material-icons text-[20px]">more_vert</span>
                                
                                <!-- Dropdown (CSS Hover for simplicity) -->
                                <div class="hidden group-hover/menu:block absolute right-8 top-0 w-48 bg-surface-container-high rounded-[12px] shadow-lg border border-outline-variant py-1 z-10 text-left">
                                    <button *ngIf="job.status === 'open'" (click)="closeJob(job, $event)"
                                        class="w-full text-left px-4 py-2 text-[13px] text-on-surface hover:bg-surface-container-highest">
                                        Close Position
                                    </button>
                                    <button *ngIf="job.status === 'closed'" (click)="reopenJob(job, $event)"
                                        class="w-full text-left px-4 py-2 text-[13px] text-on-surface hover:bg-surface-container-highest">
                                        Reopen Position
                                    </button>
                                    <a [routerLink]="['/jobs', job.id, 'edit']"
                                        class="block w-full text-left px-4 py-2 text-[13px] text-on-surface hover:bg-surface-container-highest">
                                        Edit Details
                                    </a>
                                </div>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Pagination Footer (Mock) -->
        <div class="px-6 py-3 border-t border-outline-variant flex items-center justify-between">
            <span class="text-[12px] text-on-surface-variant">Showing {{ filteredJobs.length }} positions</span>
            <div class="flex gap-2">
                <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-surface-container-highest disabled:opacity-50" disabled>
                    <span class="material-icons text-[18px] text-on-surface-variant">chevron_left</span>
                </button>
                <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-surface-container-highest disabled:opacity-50" disabled>
                    <span class="material-icons text-[18px] text-on-surface-variant">chevron_right</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && filteredJobs.length === 0" class="text-center py-20">
        <div class="w-16 h-16 bg-surface-container-high rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="material-icons text-[32px] text-on-surface-variant">search_off</span>
        </div>
        <h3 class="text-[16px] font-medium text-on-surface">No positions found</h3>
        <p class="text-[14px] text-on-surface-variant mt-1">Try adjusting your filters or create a new position.</p>
    </div>

</div>
