<div class="min-h-screen bg-gray-50" [style.--brand-color]="brandColor" [style.--text-color]="textColor">
    
    <!-- STATE A: THE HUSTLE (Loading) -->
    <div *ngIf="loading" class="min-h-screen flex items-center justify-center p-4">
        <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-gray-200 border-t-current mb-4"
                [style.border-top-color]="brandColor"></div>
            <p class="text-gray-600 font-medium">Loading your assessment...</p>
        </div>
    </div>

    <!-- STATE B: THE REALITY CHECK (Error) -->
    <div *ngIf="!loading && error" class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center">
            <svg class="w-16 h-16 mx-auto mb-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <h2 class="text-2xl font-bold text-gray-900 mb-3">Oops!</h2>
            <p class="text-gray-700 mb-6 leading-relaxed">{{ error }}</p>
            <p class="text-sm text-gray-500">If you believe this is a mistake, please reach out to your recruiter for a new link.</p>
        </div>
    </div>

    <!-- STATE C: THE FIRST IMPRESSION (Start Screen) -->
    <div *ngIf="!loading && !error && !assessmentStarted && !assessmentCompleted && assessmentData" class="min-h-screen flex flex-col">
        <!-- Header -->
        <div class="w-full p-6 text-center" [ngStyle]="{'background-color': brandColor, 'color': textColor}">
            <h1 class="text-2xl sm:text-3xl font-bold mb-2">Personality Assessment</h1>
            <p class="opacity-90 text-lg">{{ assessmentData.company.name }}</p>
        </div>

        <!-- Content -->
        <div class="flex-1 flex items-center justify-center p-4">
            <div class="max-w-lg w-full bg-white rounded-2xl shadow-xl p-6 sm:p-8">
                <!-- Job Context -->
                <div class="mb-8 text-center">
                    <p class="text-gray-600 mb-2">Assessment for:</p>
                    <h2 class="text-xl font-bold text-gray-900">{{ assessmentData.job.title }}</h2>
                </div>

                <!-- Info Box -->
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                    <h3 class="text-sm font-bold text-blue-900 mb-2">What to Expect</h3>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>‚Ä¢ {{ assessmentData.assessment.configuration?.questions_count || '60' }} questions</li>
                        <li>‚Ä¢ Takes about {{ assessmentData.assessment.configuration?.time_limit_minutes || '15-20' }} minutes</li>
                        <li>‚Ä¢ Answer honestly - there are no wrong answers</li>
                        <li>‚Ä¢ Your results help us find the perfect fit</li>
                    </ul>
                </div>

                <!-- Start Button -->
                <button (click)="startAssessment()" [disabled]="submitting"
                    class="w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    [ngStyle]="{'background-color': brandColor, 'color': textColor}">
                    <span *ngIf="!submitting">‚úì Begin Assessment</span>
                    <span *ngIf="submitting">Loading questions...</span>
                </button>

                <p class="text-xs text-center text-gray-500 mt-4">
                    By starting, you confirm you'll answer truthfully and complete the assessment in one sitting.
                </p>
            </div>
        </div>
    </div>

    <!-- STATE D: THE DEEP DIVE (Assessment In Progress) -->
    <div *ngIf="assessmentStarted && !assessmentCompleted && currentQuestion" class="min-h-screen flex flex-col">
        <!-- Sticky Header with Progress -->
        <div class="sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <!-- Progress Bar -->
                <div class="mb-3">
                    <div class="flex justify-between text-xs font-medium text-gray-600 mb-1">
                        <span>Question {{ currentQuestionIndex + 1 }} of {{ questions.length }}</span>
                        <span>{{ progress }}% Complete</span>
                    </div>
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-300 rounded-full"
                            [style.width.%]="progress"
                            [style.background-color]="brandColor"></div>
                    </div>
                </div>

                <!-- Timer (if applicable) -->
                <div *ngIf="timeRemaining > 0" class="text-center">
                    <span class="text-sm font-mono font-bold" [style.color]="brandColor">
                        ‚è± {{ timerDisplay }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Question Content -->
        <div class="flex-1 flex items-center justify-center p-4">
            <div class="max-w-2xl w-full">
                <!-- Question Card -->
                <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 mb-6">
                    <p class="text-xl sm:text-2xl font-semibold text-gray-900 text-center leading-relaxed mb-8">
                        {{ currentQuestion.question_text }}
                    </p>

                    <!-- Likert Scale -->
                    <div class="space-y-3">
                        <button *ngFor="let option of currentQuestion.scale"
                            (click)="selectAnswer(currentQuestion.id, option.value)"
                            [class.ring-4]="answers[currentQuestion.id] === option.value"
                            class="w-full py-4 px-6 rounded-xl font-medium text-left transition-all hover:shadow-md border-2"
                            [ngClass]="{
                                'bg-gray-50 border-gray-200 hover:border-gray-300': answers[currentQuestion.id] !== option.value,
                                'border-current shadow-lg': answers[currentQuestion.id] === option.value
                            }"
                            [style.border-color]="answers[currentQuestion.id] === option.value ? brandColor : ''"
                            [style.background-color]="answers[currentQuestion.id] === option.value ? brandColor + '10' : ''">
                            <div class="flex items-center justify-between">
                                <span class="flex-1">{{ option.label }}</span>
                                <span class="ml-3 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all"
                                    [style.border-color]="answers[currentQuestion.id] === option.value ? brandColor : '#D1D5DB'">
                                    <span *ngIf="answers[currentQuestion.id] === option.value" 
                                        class="w-3 h-3 rounded-full"
                                        [style.background-color]="brandColor"></span>
                                </span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="flex gap-3">
                    <button *ngIf="currentQuestionIndex > 0" (click)="previousQuestion()"
                        class="px-6 py-3 bg-white border-2 border-gray-300 rounded-xl font-semibold hover:bg-gray-50 transition-all">
                        ‚Üê Previous
                    </button>
                    
                    <button *ngIf="currentQuestionIndex < questions.length - 1 && isQuestionAnswered(currentQuestion.id)"
                        (click)="nextQuestion()"
                        class="flex-1 px-6 py-3 rounded-xl font-semibold transition-all shadow-md"
                        [ngStyle]="{'background-color': brandColor, 'color': textColor}">
                        Next ‚Üí
                    </button>

                    <button *ngIf="currentQuestionIndex === questions.length - 1 && allQuestionsAnswered"
                        (click)="submitAssessment()" [disabled]="submitting"
                        class="flex-1 px-6 py-3 rounded-xl font-bold transition-all shadow-lg disabled:opacity-50"
                        [ngStyle]="{'background-color': brandColor, 'color': textColor}">
                        <span *ngIf="!submitting">‚úì Submit Assessment</span>
                        <span *ngIf="submitting">Submitting...</span>
                    </button>
                </div>

                <!-- Quick Nav Dots -->
                <div class="flex justify-center gap-1.5 mt-6 flex-wrap">
                    <button *ngFor="let q of questions; let i = index" 
                        (click)="goToQuestion(i)"
                        class="w-2 h-2 rounded-full transition-all"
                        [ngClass]="{
                            'w-8': i === currentQuestionIndex
                        }"
                        [style.background-color]="isQuestionAnswered(q.id) ? brandColor : '#E5E7EB'"
                        [attr.aria-label]="'Go to question ' + (i + 1)">
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- STATE E: THE RIGHT HOOK (Completion & Upsell) -->
    <div *ngIf="assessmentCompleted" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-green-50 to-blue-50">
        <div class="max-w-2xl w-full space-y-6">
            <!-- Gratitude Card -->
            <div class="bg-white rounded-2xl shadow-xl p-8 text-center">
                <div class="w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center"
                    [ngStyle]="{'background-color': brandColor + '20'}">
                    <svg class="w-10 h-10" [attr.stroke]="brandColor" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                
                <h1 class="text-3xl font-bold text-gray-900 mb-3">Thank You!</h1>
                <p class="text-lg text-gray-700 mb-2">Your assessment has been submitted successfully.</p>
                <p class="text-gray-600">{{ assessmentData?.company.name }} will review your results and get back to you soon.</p>
            </div>

            <!-- THE MONETIZATION (350 Eurocent Special) -->
            <div class="bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl shadow-2xl p-8 text-white relative overflow-hidden">
                <!-- Decorative Background -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -mr-32 -mt-32"></div>
                <div class="absolute bottom-0 left-0 w-48 h-48 bg-white opacity-5 rounded-full -ml-24 -mb-24"></div>
                
                <div class="relative z-10">
                    <span class="inline-block px-3 py-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full mb-4">
                        LIMITED TIME OFFER
                    </span>
                    
                    <h2 class="text-2xl sm:text-3xl font-bold mb-3">Unlock Your Full Potential</h2>
                    <p class="text-lg mb-6 opacity-95">
                        Get a comprehensive PDF report with deep insights into your personality strengths, weaknesses, and career guidance.
                    </p>

                    <div class="bg-white/10 backdrop-blur rounded-xl p-4 mb-6 border border-white/20">
                        <h3 class="font-bold mb-2">Your Report Includes:</h3>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 mt-0.5">‚úì</span>
                                <span>Detailed personality breakdown with strengths & blind spots</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 mt-0.5">‚úì</span>
                                <span>Career path recommendations based on your type</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 mt-0.5">‚úì</span>
                                <span>Work-life balance strategies tailored to you</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 mt-0.5">‚úì</span>
                                <span>Communication style guide for better relationships</span>
                            </li>
                        </ul>
                    </div>

                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <p class="text-sm opacity-75 line-through">Regular price: ‚Ç¨9.99</p>
                            <p class="text-4xl font-bold">‚Ç¨3.50</p>
                        </div>
                        <span class="bg-red-500 text-white px-4 py-2 rounded-full font-bold text-sm">
                            65% OFF
                        </span>
                    </div>

                    <button class="w-full py-4 bg-yellow-400 hover:bg-yellow-300 text-gray-900 rounded-xl font-bold text-lg shadow-xl transition-all transform hover:scale-105">
                        üîì Get My Full Report Now
                    </button>

                    <p class="text-xs text-center mt-4 opacity-75">
                        Instant delivery ‚Ä¢ Secure payment ‚Ä¢ Money-back guarantee
                    </p>
                </div>
            </div>

            <!-- Alternative: Skip for now -->
            <button class="w-full py-3 text-gray-600 hover:text-gray-900 font-medium transition-all">
                Maybe later
            </button>
        </div>
    </div>

</div>
