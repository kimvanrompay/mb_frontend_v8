<!-- Loading State -->
<div *ngIf="isLoading" class="fixed inset-0 bg-stone-50 flex items-center justify-center">
    <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-black mb-4"></div>
        <p class="text-sm text-gray-500 uppercase tracking-wide">Loading</p>
    </div>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="fixed inset-0 bg-stone-50 flex items-center justify-center p-6">
    <div class="max-w-md text-center">
        <h2 class="text-2xl font-light text-black mb-2">Unable to Load</h2>
        <p class="text-gray-600 mb-6">{{ error }}</p>
        <button (click)="loadQuestions()"
            class="px-6 py-3 bg-black text-white text-sm font-medium hover:bg-gray-800 transition-colors rounded-lg">
            Try Again
        </button>
    </div>
</div>

<!-- Assessment Container -->
<div *ngIf="!isLoading && !error" class="min-h-screen bg-stone-50">

    <!-- Progress Bar -->
    <div class="w-full border-b border-gray-200">
        <div class="h-1 bg-black transition-all duration-500" [style.width.%]="progress"></div>
    </div>

    <!-- Header -->
    <div class="w-full border-b border-gray-100 bg-stone-50">
        <div class="px-4 sm:px-6 py-4">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <span class="text-sm text-gray-500">
                    Page <span class="font-medium text-black">{{ currentPage + 1 }}</span> of {{ totalPages }}
                </span>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-500">{{ answers.length }}/{{ questions.length }} answered</span>
                    <span class="text-sm font-medium text-black">{{ progress }}%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-8 sm:py-12">

        <!-- Questions (3 per page) -->
        <div class="space-y-12">
            <div *ngFor="let question of currentQuestions; let i = index"
                class="bg-white rounded-lg border border-gray-200 p-6 sm:p-8">

                <!-- Question Number & Text -->
                <div class="mb-6">
                    <span class="text-xs font-medium text-gray-400 uppercase tracking-wide">
                        Question {{ (currentPage * questionsPerPage) + i + 1 }} of {{ questions.length }}
                    </span>
                    <h3 class="text-xl sm:text-2xl font-light text-black mt-2 leading-snug">
                        {{ question.text }}
                    </h3>
                </div>

                <!-- Answer Options -->
                <div class="space-y-2">
                    <button *ngFor="let option of scaleOptions" (click)="selectAnswer(question.id, option)"
                        [class.ring-2]="getAnswer(question.id) === option"
                        [class.ring-black]="getAnswer(question.id) === option"
                        [class.bg-gray-50]="getAnswer(question.id) === option" class="w-full px-4 py-3 border border-gray-200 rounded-lg hover:border-black 
                               transition-all text-left flex items-center justify-between group">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 border border-gray-200 group-hover:border-black rounded flex items-center justify-center transition-colors"
                                [class.border-black]="getAnswer(question.id) === option"
                                [class.bg-black]="getAnswer(question.id) === option">
                                <span class="text-sm font-medium transition-colors"
                                    [class.text-gray-400]="getAnswer(question.id) !== option"
                                    [class.text-white]="getAnswer(question.id) === option">
                                    {{ option }}
                                </span>
                            </div>
                            <span class="text-base font-light text-gray-700 group-hover:text-black transition-colors">
                                {{ getScaleLabel(option) }}
                            </span>
                        </div>
                        <svg *ngIf="getAnswer(question.id) === option" class="w-5 h-5 text-black" fill="currentColor"
                            viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex items-center justify-between mt-12 gap-4">
            <!-- Previous Button -->
            <button *ngIf="currentPage > 0" (click)="previousPage()" class="px-6 py-3 border border-gray-300 text-gray-700 text-sm font-medium 
                       hover:bg-gray-50 transition-colors rounded-lg">
                ← Previous
            </button>
            <div *ngIf="currentPage === 0" class="w-32"></div>

            <!-- Next/Submit Button -->
            <div class="flex-1 flex justify-end">
                <button *ngIf="!isLastPage && canGoNext" (click)="nextPage()" class="px-8 py-3 bg-black text-white text-sm font-medium 
                           hover:bg-gray-800 transition-colors rounded-lg">
                    Next →
                </button>

                <button *ngIf="!isLastPage && !canGoNext" disabled class="px-8 py-3 bg-gray-200 text-gray-400 text-sm font-medium 
                           cursor-not-allowed rounded-lg">
                    Answer all questions
                </button>

                <button *ngIf="isLastPage && canGoNext && !isSubmitting" (click)="submitAssessment()" class="px-8 py-3 bg-black text-white text-sm font-medium 
                           hover:bg-gray-800 transition-colors rounded-lg">
                    Complete Assessment
                </button>

                <button *ngIf="isLastPage && !canGoNext && !isSubmitting" disabled class="px-8 py-3 bg-gray-200 text-gray-400 text-sm font-medium 
                           cursor-not-allowed rounded-lg">
                    Answer all questions
                </button>

                <button *ngIf="isSubmitting" disabled class="px-8 py-3 bg-gray-300 text-gray-500 text-sm font-medium 
                           cursor-not-allowed rounded-lg">
                    Submitting...
                </button>
            </div>
        </div>

        <!-- Helper Text -->
        <p class="text-center text-xs text-gray-400 mt-6">
            {{ isLastPage ? 'Answer all questions to complete the assessment' : 'Answer all questions to continue' }}
        </p>
    </div>
</div>