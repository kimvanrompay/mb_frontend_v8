<!-- Loading State -->
<div *ngIf="isLoading" class="fixed inset-0 bg-stone-50 flex items-center justify-center z-50">
    <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-black mb-4"></div>
        <p class="text-sm text-gray-500 uppercase tracking-wide">Loading Assessment</p>
    </div>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="fixed inset-0 bg-stone-50 flex items-center justify-center p-6 z-50">
    <div class="max-w-md text-center">
        <h2 class="text-2xl font-light text-black mb-2">Unable to Load</h2>
        <p class="text-gray-600 mb-6">{{ error }}</p>
        <button (click)="loadQuestions()"
            class="px-6 py-3 bg-black text-white text-sm font-medium hover:bg-gray-800 transition-colors rounded-lg">
            Try Again
        </button>
    </div>
</div>

<!-- Scroll Container -->
<div *ngIf="!isLoading && !error" class="scroll-container">

    <!-- Fixed Progress Bar -->
    <div class="fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200">
        <div class="h-1 bg-black transition-all duration-500" [style.width.%]="progress"></div>
        <div class="px-6 py-3 flex items-center justify-center relative">
            <span class="text-sm font-medium text-black">{{ answers.length }}/{{ questions.length }} answered</span>
            <span class="absolute right-6 text-xs text-gray-500">{{ progress }}%</span>
        </div>
    </div>

    <!-- Questions - Full Viewport Each -->
    <div class="question-section" *ngFor="let question of questions; let i = index">
        <div class="question-container">
            <!-- Question Number -->
            <div class="text-center mb-8">
                <span class="inline-block px-4 py-2 bg-black text-white text-xs font-medium rounded-full">
                    Question {{ i + 1 }} of {{ questions.length }}
                </span>
            </div>

            <!-- Question Text -->
            <h2
                class="text-3xl sm:text-4xl font-light text-black text-center mb-12 px-4 leading-tight max-w-3xl mx-auto">
                {{ getQuestionText(question) }}
            </h2>

            <!-- Answer Options -->
            <div class="max-w-2xl mx-auto px-4 space-y-3">
                <button *ngFor="let option of scaleOptions" (click)="selectAnswer(question.id, option)"
                    [class.ring-2]="getAnswer(question.id) === option"
                    [class.ring-black]="getAnswer(question.id) === option"
                    [class.bg-gray-50]="getAnswer(question.id) === option" class="w-full px-6 py-4 border border-gray-200 rounded-xl hover:border-black 
                           transition-all text-left flex items-center justify-between group">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 border-2 border-gray-200 group-hover:border-black rounded-full flex items-center justify-center transition-all"
                            [class.border-black]="getAnswer(question.id) === option"
                            [class.bg-black]="getAnswer(question.id) === option">
                            <span class="text-base font-medium transition-colors"
                                [class.text-gray-400]="getAnswer(question.id) !== option"
                                [class.text-white]="getAnswer(question.id) === option">
                                {{ option }}
                            </span>
                        </div>
                        <span class="text-lg font-light text-gray-700 group-hover:text-black transition-colors">
                            {{ getScaleLabel(option) }}
                        </span>
                    </div>
                    <svg *ngIf="getAnswer(question.id) === option" class="w-6 h-6 text-black" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                            clip-rule="evenodd" />
                    </svg>
                </button>
            </div>

            <!-- Scroll Hint -->
            <div class="text-center mt-12 opacity-50">
                <p class="text-xs text-gray-400">Scroll down for next question</p>
                <svg class="w-5 h-5 mx-auto mt-2 animate-bounce text-gray-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Submit Section - Last Viewport -->
    <div class="question-section">
        <div class="question-container">
            <div class="text-center">
                <!-- Completion Icon -->
                <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-black flex items-center justify-center">
                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                            clip-rule="evenodd" />
                    </svg>
                </div>

                <h2 class="text-3xl sm:text-4xl font-light text-black mb-4">Ready to Submit?</h2>
                <p class="text-lg text-gray-600 mb-12 max-w-lg mx-auto px-4">
                    You've answered {{ answers.length }} of {{ questions.length }} questions
                </p>

                <!-- Submit Button -->
                <button *ngIf="canSubmit && !isSubmitting" (click)="submitAssessment()" class="px-12 py-4 bg-black text-white text-base font-medium hover:bg-gray-800 
                           transition-all rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                    Complete Assessment
                </button>

                <button *ngIf="!canSubmit && !isSubmitting" disabled
                    class="px-12 py-4 bg-gray-200 text-gray-400 text-base font-medium cursor-not-allowed rounded-lg">
                    Please answer all questions
                </button>

                <button *ngIf="isSubmitting" disabled
                    class="px-12 py-4 bg-gray-300 text-gray-500 text-base font-medium cursor-not-allowed rounded-lg">
                    <span class="inline-block animate-spin mr-2">‚è≥</span>
                    Submitting...
                </button>
            </div>
        </div>
    </div>
</div>