<!-- Loading State -->
<div *ngIf="isLoading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
    <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-black mb-4"></div>
        <p class="text-gray-600">Loading assessment...</p>
    </div>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="fixed inset-0 bg-white flex items-center justify-center z-50 p-6">
    <div class="max-w-md text-center">
        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
        <h2 class="text-2xl font-bold text-black mb-4">Oops!</h2>
        <p class="text-gray-600 mb-6">{{ error }}</p>
        <button (click)="loadQuestions()" class="px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition">
            Try Again
        </button>
    </div>
</div>

<!-- Assessment Container -->
<div *ngIf="!isLoading && !error" class="fixed inset-0 bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col">

    <!-- Progress Bar -->
    <div class="w-full bg-white border-b border-gray-200">
        <div class="h-2 bg-black transition-all duration-500 ease-out" [style.width.%]="progress"></div>
    </div>

    <!-- Header -->
    <div class="w-full bg-white border-b border-gray-200 px-4 sm:px-6 py-4">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <button *ngIf="currentQuestionIndex > 0" (click)="previousQuestion()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <span class="text-sm font-medium text-gray-600">
                    Question {{ currentQuestionIndex + 1 }} of {{ questions.length }}
                </span>
            </div>
            <span class="text-sm font-medium text-black">{{ progress }}%</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-y-auto">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 py-12 sm:py-20">

            <!-- Question Number Badge -->
            <div class="mb-6 sm:mb-8">
                <span class="inline-flex items-center px-4 py-2 rounded-full bg-black/5 text-sm font-medium text-black">
                    {{ currentQuestionIndex + 1 }} / {{ questions.length }}
                </span>
            </div>

            <!-- Question Text -->
            <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-black mb-12 sm:mb-16 leading-tight">
                {{ currentQuestionText }}
            </h2>

            <!-- Answer Options (Likert Scale) -->
            <div class="space-y-3 sm:space-y-4">
                <button *ngFor="let option of scaleOptions" (click)="selectAnswer(option)"
                    [class.selected]="currentAnswer === option" class="answer-option group w-full text-left px-6 sm:px-8 py-5 sm:py-6 rounded-xl border-2 transition-all duration-200
                           bg-white border-gray-200 hover:border-black hover:bg-gray-50
                           focus:outline-none focus:ring-4 focus:ring-black/10">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <!-- Radio Circle -->
                            <div class="flex-shrink-0 w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-black transition-colors
                                        flex items-center justify-center">
                                <div *ngIf="currentAnswer === option" class="w-3 h-3 rounded-full bg-black"></div>
                            </div>
                            <!-- Label -->
                            <div>
                                <span
                                    class="text-lg sm:text-xl font-medium text-black group-hover:text-black transition-colors">
                                    {{ getScaleLabel(option) }}
                                </span>
                                <div class="text-sm text-gray-500 mt-1">
                                    <span *ngIf="option === 1">üö´</span>
                                    <span *ngIf="option === 2">üëé</span>
                                    <span *ngIf="option === 3">ü§∑</span>
                                    <span *ngIf="option === 4">üëç</span>
                                    <span *ngIf="option === 5">‚ú®</span>
                                </div>
                            </div>
                        </div>
                        <!-- Keyboard Shortcut Hint (desktop only) -->
                        <span class="hidden sm:block text-sm text-gray-400 font-mono">{{ option }}</span>
                    </div>
                </button>
            </div>

            <!-- Navigation Buttons -->
            <div class="mt-12 sm:mt-16 flex items-center justify-between">
                <button *ngIf="currentQuestionIndex > 0" (click)="previousQuestion()"
                    class="px-6 py-3 text-gray-600 hover:text-black transition-colors font-medium">
                    ‚Üê Back
                </button>
                <div class="flex-1"></div>

                <!-- Next/Submit Button (only if answered) -->
                <button *ngIf="currentAnswer !== null && currentQuestionIndex < questions.length - 1"
                    (click)="nextQuestion()"
                    class="px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition font-medium">
                    Next ‚Üí
                </button>

                <button *ngIf="currentAnswer !== null && currentQuestionIndex === questions.length - 1 && !isSubmitting"
                    (click)="submitAssessment()"
                    class="px-8 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition font-medium">
                    Complete Assessment ‚úì
                </button>

                <button *ngIf="isSubmitting" disabled
                    class="px-8 py-3 bg-gray-400 text-white rounded-lg font-medium cursor-not-allowed">
                    <span class="inline-flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        Submitting...
                    </span>
                </button>
            </div>

        </div>
    </div>

    <!-- Progress Dots (Mobile - Bottom) -->
    <div class="sm:hidden w-full bg-white border-t border-gray-200 px-4 py-4 overflow-x-auto">
        <div class="flex items-center justify-start space-x-2 min-w-max">
            <button *ngFor="let q of questions; let i = index" (click)="goToQuestion(i)"
                [class.answered]="isQuestionAnswered(q.id)" [class.current]="i === currentQuestionIndex"
                class="progress-dot flex-shrink-0 w-3 h-3 rounded-full transition-all duration-200">
            </button>
        </div>
    </div>

</div>

<!-- Keyboard Navigation Hint (Desktop) -->
<div *ngIf="!isLoading && !error" class="hidden sm:block fixed bottom-6 left-6 text-xs text-gray-400">
    <div class="bg-white/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-gray-200">
        Press <kbd class="px-2 py-1 bg-gray-100 rounded font-mono">1-5</kbd> to answer
    </div>
</div>